#include "GL/glew.h"
#include "core/lander_model.h"
#include "tools/linmath.h"
#include "tools/glt_tools.h"

static GLfloat position_data[];

void lndr_gen_colors(GLfloat *buf)
{
    int i;
    for(i = 0; i < 56 * 3; i += 3)
    {
        buf[i] = i % 2 ? 1 : 0;
        buf[i + 1] = 0;
        buf[i + 2] = i % 2 ? 0 : 1;
    }
}

Lander lndr_new()
{
    GLfloat cbuf[56 * 3];
    lndr_gen_colors(cbuf);

    Lander lander;
    lander.mesh = mh_make(position_data, NULL, 56);

    mh_set_u_color(&lander.mesh, 1, 1, 0);

    return lander;
}

void lndr_render(Lander *lander)
{
    glBindVertexArray(lander->mesh.VAO);
    mat4x4 ident;
    mat4x4_identity(ident);

    mat4x4 mv;

    mat4x4_scale_aniso(mv, ident, 1 / ASPECT_RATIO, 1.0, 1.0);

    mat4x4 mvo;
    mat4x4_transpose(mvo, mv);
    glUniformMatrix4fv(glob_locs.uMVMatrix, 1, GL_FALSE, (GLfloat *)mvo);

    mh_prepare_for_render(&lander->mesh);

    glDrawArrays(GL_LINES, 0, 112);
    glBindVertexArray(0);
}

static GLfloat position_data[] = {
        -1.875000e-01, 0.500000,
        0.187500, 0.500000,
        -1.875000e-01, 0.500000,
        -3.125000e-01, 0.382353,
        0.187500, 0.500000,
        0.312500, 0.382353,
        -3.125000e-01, 0.382353,
        -3.125000e-01, 0.147059,
        0.312500, 0.382353,
        0.312500, 0.147059,
        -3.125000e-01, 0.147059,
        -1.875000e-01, 0.029412,
        0.312500, 0.147059,
        0.187500, 0.029412,
        -3.125000e-01, 0.029412,
        0.312500, 0.029412,
        -3.125000e-01, 0.029412,
        -3.125000e-01, -1.470588e-01,
        0.312500, 0.029412,
        0.312500, -1.470588e-01,
        -3.125000e-01, -1.470588e-01,
        0.312500, -1.470588e-01,
        -3.125000e-01, -5.882353e-02,
        -4.375000e-01, -3.235294e-01,
        0.312500, -5.882353e-02,
        0.437500, -3.235294e-01,
        -2.187500e-01, -1.470588e-01,
        -4.375000e-01, -3.235294e-01,
        0.218750, -1.470588e-01,
        0.437500, -3.235294e-01,
        -4.375000e-01, -3.235294e-01,
        -4.375000e-01, -4.411765e-01,
        0.437500, -3.235294e-01,
        0.437500, -4.411765e-01,
        -5.000000e-01, -4.411765e-01,
        -3.750000e-01, -4.411765e-01,
        0.375000, -4.411765e-01,
        0.500000, -4.411765e-01,
        -9.375000e-02, -1.470588e-01,
        -9.375000e-02, -2.058824e-01,
        0.093750, -1.470588e-01,
        0.093750, -2.058824e-01,
        -9.375000e-02, -2.058824e-01,
        0.093750, -2.058824e-01,
        -9.375000e-02, -2.058824e-01,
        -1.562500e-01, -3.235294e-01,
        0.093750, -2.058824e-01,
        0.156250, -3.235294e-01,
        -1.562500e-01, -3.235294e-01,
        0.156250, -3.235294e-01,
        -1.562500e-01, -3.235294e-01,
        -1.562500e-01, -3.529412e-01,
        0.156250, -3.235294e-01,
        0.156250, -3.529412e-01,
        -1.562500e-01, -3.529412e-01,
        0.156250, -3.529412e-01
};

